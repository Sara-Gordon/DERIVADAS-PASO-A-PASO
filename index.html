<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Derivadas por Primer Principio</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      background-color: #fff0f6;
      font-family: 'Segoe UI', sans-serif;
      color: #660033;
      margin: 40px;
    }
    h1 {
      text-align: center;
      color: #cc0066;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #cc6699;
    }
    .output {
      background: #ffe6f0;
      padding: 20px;
      border-radius: 15px;
      margin-top: 20px;
      box-shadow: 0 4px 8px #f2cce0;
    }
    .step {
      margin-bottom: 15px;
    }
    #plot {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <h1>ðŸŒ¸ Derivada por Primer Principio ðŸŒ¸</h1>

  <label for="funcion">Ingresa la funciÃ³n f(x):</label><br>
  <input type="text" id="funcion" placeholder="Ejemplo: x^2 + 2x"><br>
  <button onclick="resolver()">ðŸ“˜ Calcular derivada</button>

  <div id="resultado" class="output"></div>
  <div id="plot"></div>

  <script>
    function resolver() {
      const fxText = document.getElementById("funcion").value;
      const x = math.symbolicEval('x');
      const h = math.symbolicEval('h');

      try {
        const f = math.parse(fxText);
        const fxh = f.transform(node => node.substitute('x', `x + h`));
        const diferencia = new math.OperatorNode('-', 'subtract', [fxh, f]);
        const cociente = new math.OperatorNode('/', 'divide', [diferencia, h]);
        const derivadaPaso8 = math.simplify(cociente).evaluate({ h: 0 });
        const derivadaFuncion = math.simplify(math.derivative(f, 'x')).toString();

        const pasos = [
          "1ï¸âƒ£ Se plantea la fÃ³rmula general: $$f'(x) = \\lim_{h \\to 0} \\frac{f(x+h) - f(x)}{h}$$",
          `2ï¸âƒ£ Sustituyendo f(x): $$= \\frac{f(${fxText.replace(/x/g, "x + h")}) - (${fxText})}{h}$$`,
          `3ï¸âƒ£ Se desarrolla f(x + h): AquÃ­ se expande el binomio o tÃ©rminos`,
          `4ï¸âƒ£ Se eliminan parÃ©ntesis y se simplifica la parte superior`,
          `5ï¸âƒ£ Se cancelan tÃ©rminos semejantes`,
          `6ï¸âƒ£ Se extrae h como factor comÃºn en el numerador`,
          `7ï¸âƒ£ Se simplifica el h con el denominador`,
          `8ï¸âƒ£ Se evalÃºa el lÃ­mite cuando h â†’ 0: Resultado: $$f'(x) = ${derivadaFuncion}$$`
        ];

        let resultadoHTML = "";
        pasos.forEach(p => {
          resultadoHTML += `<div class="step">${p}</div>`;
        });

        document.getElementById("resultado").innerHTML = resultadoHTML;
        MathJax.typeset();

        graficar(fxText, derivadaFuncion);
      } catch (error) {
        document.getElementById("resultado").innerHTML = "âš ï¸ Error al procesar la funciÃ³n. AsegÃºrate de escribirla correctamente (ej. x^2, sin(x), etc)";
      }
    }

    function graficar(fxText, dfxText) {
      const fx = x => math.evaluate(fxText, {x});
      const dfx = x => math.evaluate(dfxText, {x});
      const xValues = math.range(-10, 10, 0.5).toArray();
      const y1 = xValues.map(x => fx(x));
      const y2 = xValues.map(x => dfx(x));

      const trace1 = {
        x: xValues,
        y: y1,
        mode: "lines",
        name: "f(x)",
        line: { color: "#d63384" }
      };
      const trace2 = {
        x: xValues,
        y: y2,
        mode: "lines",
        name: "f'(x)",
        line: { color: "#99004d", dash: 'dot' }
      };

      const layout = {
        title: "ðŸ“Š GrÃ¡fica de f(x) y f'(x)",
        xaxis: { title: "x", showgrid: true },
        yaxis: { title: "y", showgrid: true },
        plot_bgcolor: "#fff0f6",
        paper_bgcolor: "#fff0f6"
      };

      Plotly.newPlot("plot", [trace1, trace2], layout);
    }
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
</body>
</html>


